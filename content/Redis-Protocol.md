+++
title = "Redis 协议简介"
draft = true
date = "2017-03-04T23:22:05+08:00"
categories = [ "Database" ]
tags = ["Redis"]

+++

# 简介

Redis 的客户端和服务端之间采取了一种独立名为 RESP(REdis Serialization Protocol) 的协议，作者主要考虑了以下几个点：

* 容易实现
* 解析快
* 人类可读

注意：RESP 虽然是为 Redis 设计的，但是同样也可以用于其他 C/S 的软件。


# 数据类型及应答

RESP 主要可以序列化以下几种类型：整数，单行回复(简单字符串)，数组，错误信息，多行字符串。Redis 客户端向服务端发送的是一组由执行的命令组成的字符串数组，服务端根据不同的命令回复不同类型的数据，但协议的每部分都是以 "\r\n" (CRLF) 结尾的。另外 RESP 是二进制安全的，不需要处理从一个进程到另一个进程的传输，因为它使用了前缀长度进行传输。

在 RESP 中, 一些数据的类型通过它的第一个字节进行判断：

* 单行回复：回复的第一个字节是 "+"
* 错误信息：回复的第一个字节是 "-"
* 整形数字：回复的第一个字节是 ":"
* 多行字符串：回复的第一个字节是 "\$"
* 数组：回复的第一个字节是 "*"

## 单行回复

以 "+" 开头，以 "\r\n" 结尾的字符串形式。e.g.

```
+OK\r\n
```

响应的客户端库，应该返回除 "+" 和 CRLF 以外的内容，例如上面的内容，则返回 "OK". e.g.

```
127.0.0.1:6379> set name TaoBeier
OK
```

## 错误信息

错误信息和单行回复很像，不过是把 "+" 替换成了 "-"。而这两者之间真正的区别是，错误信息会被客户端视为异常，并且组成错误类型的是错误消息本身。e.g.

```
-Error message\r\n
```

错误信息只在有错误发生的时候才会发送，比如数据类型错误，语法错误，或者命令不存在之类的。而当接收到错误信息的时候，客户端库应该抛出一个异常。e.g.

```
127.0.0.1:6379> TaoBeier
(error) ERR unknown command 'TaoBeier'
127.0.0.1:6379> set name TaoBeier moelove
(error) ERR syntax error
```

## 整数

这种类型只是只是使用以 ":" 作为前缀，以CRLF作为结尾的字符串来表示整数。e.g. ":666\r\n" 或者 ":999\r\n" 这种的都是整数回复。很多命令都会返回整数回复，例如 `INCR` `LLEN` `LPUSH` 之类的命令。但是多数情况下，返回的整数回复并没有过多实际含义，例如 `LPUSH` 就只是为了表示插入了几个值，但也有例如 `EXISTS` 命令是当结果为 true 的时候返回 1，false 返回 0 . e.g.

```
127.0.0.1:6379> LPUSH info TaoBeier MoeLove
(integer) 2
127.0.0.1:6379> LLEN info
(integer) 2
127.0.0.1:6379> EXISTS info
(integer) 1
127.0.0.1:6379> DEL info
(integer) 1
127.0.0.1:6379> EXISTS info
(integer) 0
```

## 多行字符串
## 数组
